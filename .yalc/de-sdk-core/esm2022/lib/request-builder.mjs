/* tslint:disable */
/* eslint-disable */
/* Code generated by ng-openapi-gen DO NOT EDIT. */
import { HttpRequest, HttpParams, HttpHeaders } from '@angular/common/http';
/**
 * Custom parameter codec to correctly handle the plus sign in parameter
 * values. See https://github.com/angular/angular/issues/18261
 */
class ParameterCodec {
    encodeKey(key) {
        return encodeURIComponent(key);
    }
    encodeValue(value) {
        return encodeURIComponent(value);
    }
    decodeKey(key) {
        return decodeURIComponent(key);
    }
    decodeValue(value) {
        return decodeURIComponent(value);
    }
}
const ParameterCodecInstance = new ParameterCodec();
/**
 * Base class for a parameter
 */
class Parameter {
    constructor(name, value, options, defaultStyle, defaultExplode) {
        this.name = name;
        this.value = value;
        this.options = options;
        this.options = options || {};
        if (this.options.style === null || this.options.style === undefined) {
            this.options.style = defaultStyle;
        }
        if (this.options.explode === null || this.options.explode === undefined) {
            this.options.explode = defaultExplode;
        }
    }
    serializeValue(value, separator = ',') {
        if (value === null || value === undefined) {
            return '';
        }
        else if (value instanceof Array) {
            return value.map(v => this.serializeValue(v).split(separator).join(encodeURIComponent(separator))).join(separator);
        }
        else if (typeof value === 'object') {
            const array = [];
            for (const key of Object.keys(value)) {
                let propVal = value[key];
                if (propVal !== null && propVal !== undefined) {
                    propVal = this.serializeValue(propVal).split(separator).join(encodeURIComponent(separator));
                    if (this.options.explode) {
                        array.push(`${key}=${propVal}`);
                    }
                    else {
                        array.push(key);
                        array.push(propVal);
                    }
                }
            }
            return array.join(separator);
        }
        else {
            return String(value);
        }
    }
}
/**
 * A parameter in the operation path
 */
class PathParameter extends Parameter {
    constructor(name, value, options) {
        super(name, value, options, 'simple', false);
    }
    append(path) {
        let value = this.value;
        if (value === null || value === undefined) {
            value = '';
        }
        let prefix = this.options.style === 'label' ? '.' : '';
        let separator = this.options.explode ? prefix === '' ? ',' : prefix : ',';
        let alreadySerialized = false;
        if (this.options.style === 'matrix') {
            // The parameter name is just used as prefix, except in some cases...
            prefix = `;${this.name}=`;
            if (this.options.explode && typeof value === 'object') {
                prefix = ';';
                if (value instanceof Array) {
                    // For arrays we have to repeat the name for each element
                    value = value.map(v => `${this.name}=${this.serializeValue(v, ';')}`);
                    value = value.join(';');
                    alreadySerialized = true;
                }
                else {
                    // For objects we have to put each the key / value pairs
                    value = this.serializeValue(value, ';');
                    alreadySerialized = true;
                }
            }
        }
        value = prefix + (alreadySerialized ? value : this.serializeValue(value, separator));
        // Replace both the plain variable and the corresponding variant taking in the prefix and explode into account
        path = path.replace(`{${this.name}}`, value);
        path = path.replace(`{${prefix}${this.name}${this.options.explode ? '*' : ''}}`, value);
        return path;
    }
    // @ts-ignore
    serializeValue(value, separator = ',') {
        var result = typeof value === 'string' ? encodeURIComponent(value) : super.serializeValue(value, separator);
        result = result.replace(/%3D/g, '=');
        result = result.replace(/%3B/g, ';');
        result = result.replace(/%2C/g, ',');
        return result;
    }
}
/**
 * A parameter in the query
 */
class QueryParameter extends Parameter {
    constructor(name, value, options) {
        super(name, value, options, 'form', true);
    }
    append(params) {
        if (this.value instanceof Array) {
            // Array serialization
            if (this.options.explode) {
                for (const v of this.value) {
                    params = params.append(this.name, this.serializeValue(v));
                }
            }
            else {
                const separator = this.options.style === 'spaceDelimited'
                    ? ' ' : this.options.style === 'pipeDelimited'
                    ? '|' : ',';
                return params.append(this.name, this.serializeValue(this.value, separator));
            }
        }
        else if (this.value !== null && typeof this.value === 'object') {
            // Object serialization
            if (this.options.style === 'deepObject') {
                // Append a parameter for each key, in the form `name[key]`
                for (const key of Object.keys(this.value)) {
                    const propVal = this.value[key];
                    if (propVal !== null && propVal !== undefined) {
                        params = params.append(`${this.name}[${key}]`, this.serializeValue(propVal));
                    }
                }
            }
            else if (this.options.explode) {
                // Append a parameter for each key without using the parameter name
                for (const key of Object.keys(this.value)) {
                    const propVal = this.value[key];
                    if (propVal !== null && propVal !== undefined) {
                        params = params.append(key, this.serializeValue(propVal));
                    }
                }
            }
            else {
                // Append a single parameter whose values are a comma-separated list of key,value,key,value...
                const array = [];
                for (const key of Object.keys(this.value)) {
                    const propVal = this.value[key];
                    if (propVal !== null && propVal !== undefined) {
                        array.push(key);
                        array.push(propVal);
                    }
                }
                params = params.append(this.name, this.serializeValue(array));
            }
        }
        else if (this.value !== null && this.value !== undefined) {
            // Plain value
            params = params.append(this.name, this.serializeValue(this.value));
        }
        return params;
    }
}
/**
 * A parameter in the HTTP request header
 */
class HeaderParameter extends Parameter {
    constructor(name, value, options) {
        super(name, value, options, 'simple', false);
    }
    append(headers) {
        if (this.value !== null && this.value !== undefined) {
            if (this.value instanceof Array) {
                for (const v of this.value) {
                    headers = headers.append(this.name, this.serializeValue(v));
                }
            }
            else {
                headers = headers.append(this.name, this.serializeValue(this.value));
            }
        }
        return headers;
    }
}
/**
 * Helper to build http requests from parameters
 */
export class RequestBuilder {
    constructor(rootUrl, operationPath, method) {
        this.rootUrl = rootUrl;
        this.operationPath = operationPath;
        this.method = method;
        this._path = new Map();
        this._query = new Map();
        this._header = new Map();
    }
    /**
     * Sets a path parameter
     */
    path(name, value, options) {
        this._path.set(name, new PathParameter(name, value, options || {}));
    }
    /**
     * Sets a query parameter
     */
    query(name, value, options) {
        this._query.set(name, new QueryParameter(name, value, options || {}));
    }
    /**
     * Sets a header parameter
     */
    header(name, value, options) {
        this._header.set(name, new HeaderParameter(name, value, options || {}));
    }
    /**
     * Sets the body content, along with the content type
     */
    body(value, contentType = 'application/json') {
        if (value instanceof Blob) {
            this._bodyContentType = value.type;
        }
        else {
            this._bodyContentType = contentType;
        }
        if (this._bodyContentType === 'application/x-www-form-urlencoded' && value !== null && typeof value === 'object') {
            // Handle URL-encoded data
            const pairs = [];
            for (const key of Object.keys(value)) {
                let val = value[key];
                if (!(val instanceof Array)) {
                    val = [val];
                }
                for (const v of val) {
                    const formValue = this.formDataValue(v);
                    if (formValue !== null) {
                        pairs.push([key, formValue]);
                    }
                }
            }
            this._bodyContent = pairs.map(p => `${encodeURIComponent(p[0])}=${encodeURIComponent(p[1])}`).join('&');
        }
        else if (this._bodyContentType === 'multipart/form-data') {
            // Handle multipart form data
            const formData = new FormData();
            if (value !== null && value !== undefined) {
                for (const key of Object.keys(value)) {
                    const val = value[key];
                    if (val instanceof Array) {
                        for (const v of val) {
                            const toAppend = this.formDataValue(v);
                            if (toAppend !== null) {
                                formData.append(key, toAppend);
                            }
                        }
                    }
                    else {
                        const toAppend = this.formDataValue(val);
                        if (toAppend !== null) {
                            formData.set(key, toAppend);
                        }
                    }
                }
            }
            this._bodyContent = formData;
        }
        else {
            // The body is the plain content
            this._bodyContent = value;
        }
    }
    formDataValue(value) {
        if (value === null || value === undefined) {
            return null;
        }
        if (value instanceof Blob) {
            return value;
        }
        if (typeof value === 'object') {
            return new Blob([JSON.stringify(value)], { type: 'application/json' });
        }
        return String(value);
    }
    /**
     * Builds the request with the current set parameters
     */
    build(options) {
        options = options || {};
        // Path parameters
        let path = this.operationPath;
        for (const pathParam of this._path.values()) {
            path = pathParam.append(path);
        }
        const url = this.rootUrl + path;
        // Query parameters
        let httpParams = new HttpParams({
            encoder: ParameterCodecInstance
        });
        for (const queryParam of this._query.values()) {
            httpParams = queryParam.append(httpParams);
        }
        // Header parameters
        let httpHeaders = new HttpHeaders();
        if (options.accept) {
            httpHeaders = httpHeaders.append('Accept', options.accept);
        }
        for (const headerParam of this._header.values()) {
            httpHeaders = headerParam.append(httpHeaders);
        }
        // Request content headers
        if (this._bodyContentType && !(this._bodyContent instanceof FormData)) {
            httpHeaders = httpHeaders.set('Content-Type', this._bodyContentType);
        }
        // Perform the request
        return new HttpRequest(this.method.toUpperCase(), url, this._bodyContent, {
            params: httpParams,
            headers: httpHeaders,
            responseType: options.responseType,
            reportProgress: options.reportProgress,
            context: options.context
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVxdWVzdC1idWlsZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc2RrY29yZS9zcmMvbGliL3JlcXVlc3QtYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCLG1EQUFtRDtBQUVuRCxPQUFPLEVBQUUsV0FBVyxFQUFzQixVQUFVLEVBQUUsV0FBVyxFQUFlLE1BQU0sc0JBQXNCLENBQUM7QUFFN0c7OztHQUdHO0FBQ0gsTUFBTSxjQUFjO0lBQ2xCLFNBQVMsQ0FBQyxHQUFXO1FBQ25CLE9BQU8sa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVELFdBQVcsQ0FBQyxLQUFhO1FBQ3ZCLE9BQU8sa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELFNBQVMsQ0FBQyxHQUFXO1FBQ25CLE9BQU8sa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVELFdBQVcsQ0FBQyxLQUFhO1FBQ3ZCLE9BQU8sa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkMsQ0FBQztDQUNGO0FBQ0QsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0FBVXBEOztHQUVHO0FBQ0gsTUFBZSxTQUFTO0lBQ3RCLFlBQW1CLElBQVksRUFBUyxLQUFVLEVBQVMsT0FBeUIsRUFBRSxZQUFvQixFQUFFLGNBQXVCO1FBQWhILFNBQUksR0FBSixJQUFJLENBQVE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFLO1FBQVMsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDbEYsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQzdCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEtBQUssSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxLQUFLLFNBQVMs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QixJQUFJLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3BDLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ25CLFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDN0QsQ0FBQztRQUNELEtBQUssTUFBTSxXQUFXLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDO1lBQ2hELFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFFRCwwQkFBMEI7UUFDMUIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLFlBQVksUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUN0RSxXQUFXLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdkUsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixPQUFPLElBQUksV0FBVyxDQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDM0UsTUFBTSxFQUFFLFVBQVU7WUFDbEIsT0FBTyxFQUFFLFdBQVc7WUFDcEIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZO1lBQ2xDLGNBQWMsRUFBRSxPQUFPLENBQUMsY0FBYztZQUN0QyxPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87U0FDekIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyogdHNsaW50OmRpc2FibGUgKi9cbi8qIGVzbGludC1kaXNhYmxlICovXG4vKiBDb2RlIGdlbmVyYXRlZCBieSBuZy1vcGVuYXBpLWdlbiBETyBOT1QgRURJVC4gKi9cblxuaW1wb3J0IHsgSHR0cFJlcXVlc3QsIEh0dHBQYXJhbWV0ZXJDb2RlYywgSHR0cFBhcmFtcywgSHR0cEhlYWRlcnMsIEh0dHBDb250ZXh0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG4vKipcbiAqIEN1c3RvbSBwYXJhbWV0ZXIgY29kZWMgdG8gY29ycmVjdGx5IGhhbmRsZSB0aGUgcGx1cyBzaWduIGluIHBhcmFtZXRlclxuICogdmFsdWVzLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMTgyNjFcbiAqL1xuY2xhc3MgUGFyYW1ldGVyQ29kZWMgaW1wbGVtZW50cyBIdHRwUGFyYW1ldGVyQ29kZWMge1xuICBlbmNvZGVLZXkoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoa2V5KTtcbiAgfVxuXG4gIGVuY29kZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICB9XG5cbiAgZGVjb2RlS2V5KGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGtleSk7XG4gIH1cblxuICBkZWNvZGVWYWx1ZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgfVxufVxuY29uc3QgUGFyYW1ldGVyQ29kZWNJbnN0YW5jZSA9IG5ldyBQYXJhbWV0ZXJDb2RlYygpO1xuXG4vKipcbiAqIERlZmluZXMgdGhlIG9wdGlvbnMgZm9yIGFwcGVuZGluZyBhIHBhcmFtZXRlclxuICovXG5pbnRlcmZhY2UgUGFyYW1ldGVyT3B0aW9ucyB7XG4gIHN0eWxlPzogc3RyaW5nO1xuICBleHBsb2RlPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhIHBhcmFtZXRlclxuICovXG5hYnN0cmFjdCBjbGFzcyBQYXJhbWV0ZXIge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCBwdWJsaWMgdmFsdWU6IGFueSwgcHVibGljIG9wdGlvbnM6IFBhcmFtZXRlck9wdGlvbnMsIGRlZmF1bHRTdHlsZTogc3RyaW5nLCBkZWZhdWx0RXhwbG9kZTogYm9vbGVhbikge1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgaWYgKHRoaXMub3B0aW9ucy5zdHlsZSA9PT0gbnVsbCB8fCB0aGlzLm9wdGlvbnMuc3R5bGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5vcHRpb25zLnN0eWxlID0gZGVmYXVsdFN0eWxlO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zLmV4cGxvZGUgPT09IG51bGwgfHwgdGhpcy5vcHRpb25zLmV4cGxvZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5vcHRpb25zLmV4cGxvZGUgPSBkZWZhdWx0RXhwbG9kZTtcbiAgICB9XG4gIH1cblxuICBzZXJpYWxpemVWYWx1ZSh2YWx1ZTogYW55LCBzZXBhcmF0b3IgPSAnLCcpOiBzdHJpbmcge1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gdmFsdWUubWFwKHYgPT4gdGhpcy5zZXJpYWxpemVWYWx1ZSh2KS5zcGxpdChzZXBhcmF0b3IpLmpvaW4oZW5jb2RlVVJJQ29tcG9uZW50KHNlcGFyYXRvcikpKS5qb2luKHNlcGFyYXRvcik7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICBjb25zdCBhcnJheTogc3RyaW5nW10gPSBbXTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHZhbHVlKSkge1xuICAgICAgICBsZXQgcHJvcFZhbCA9IHZhbHVlW2tleV07XG4gICAgICAgIGlmIChwcm9wVmFsICE9PSBudWxsICYmIHByb3BWYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHByb3BWYWwgPSB0aGlzLnNlcmlhbGl6ZVZhbHVlKHByb3BWYWwpLnNwbGl0KHNlcGFyYXRvcikuam9pbihlbmNvZGVVUklDb21wb25lbnQoc2VwYXJhdG9yKSk7XG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5leHBsb2RlKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKGAke2tleX09JHtwcm9wVmFsfWApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKGtleSk7XG4gICAgICAgICAgICBhcnJheS5wdXNoKHByb3BWYWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGFycmF5LmpvaW4oc2VwYXJhdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQSBwYXJhbWV0ZXIgaW4gdGhlIG9wZXJhdGlvbiBwYXRoXG4gKi9cbmNsYXNzIFBhdGhQYXJhbWV0ZXIgZXh0ZW5kcyBQYXJhbWV0ZXIge1xuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIG9wdGlvbnM6IFBhcmFtZXRlck9wdGlvbnMpIHtcbiAgICBzdXBlcihuYW1lLCB2YWx1ZSwgb3B0aW9ucywgJ3NpbXBsZScsIGZhbHNlKTtcbiAgfVxuXG4gIGFwcGVuZChwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHZhbHVlID0gJyc7XG4gICAgfVxuICAgIGxldCBwcmVmaXggPSB0aGlzLm9wdGlvbnMuc3R5bGUgPT09ICdsYWJlbCcgPyAnLicgOiAnJztcbiAgICBsZXQgc2VwYXJhdG9yID0gdGhpcy5vcHRpb25zLmV4cGxvZGUgPyBwcmVmaXggPT09ICcnID8gJywnIDogcHJlZml4IDogJywnO1xuICAgIGxldCBhbHJlYWR5U2VyaWFsaXplZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUgPT09ICdtYXRyaXgnKSB7XG4gICAgICAvLyBUaGUgcGFyYW1ldGVyIG5hbWUgaXMganVzdCB1c2VkIGFzIHByZWZpeCwgZXhjZXB0IGluIHNvbWUgY2FzZXMuLi5cbiAgICAgIHByZWZpeCA9IGA7JHt0aGlzLm5hbWV9PWA7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmV4cGxvZGUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICBwcmVmaXggPSAnOyc7XG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgLy8gRm9yIGFycmF5cyB3ZSBoYXZlIHRvIHJlcGVhdCB0aGUgbmFtZSBmb3IgZWFjaCBlbGVtZW50XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS5tYXAodiA9PiBgJHt0aGlzLm5hbWV9PSR7dGhpcy5zZXJpYWxpemVWYWx1ZSh2LCAnOycpfWApO1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuam9pbignOycpO1xuICAgICAgICAgIGFscmVhZHlTZXJpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGb3Igb2JqZWN0cyB3ZSBoYXZlIHRvIHB1dCBlYWNoIHRoZSBrZXkgLyB2YWx1ZSBwYWlyc1xuICAgICAgICAgIHZhbHVlID0gdGhpcy5zZXJpYWxpemVWYWx1ZSh2YWx1ZSwgJzsnKTtcbiAgICAgICAgICBhbHJlYWR5U2VyaWFsaXplZCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB2YWx1ZSA9IHByZWZpeCArIChhbHJlYWR5U2VyaWFsaXplZCA/IHZhbHVlIDogdGhpcy5zZXJpYWxpemVWYWx1ZSh2YWx1ZSwgc2VwYXJhdG9yKSk7XG4gICAgLy8gUmVwbGFjZSBib3RoIHRoZSBwbGFpbiB2YXJpYWJsZSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcgdmFyaWFudCB0YWtpbmcgaW4gdGhlIHByZWZpeCBhbmQgZXhwbG9kZSBpbnRvIGFjY291bnRcbiAgICBwYXRoID0gcGF0aC5yZXBsYWNlKGB7JHt0aGlzLm5hbWV9fWAsIHZhbHVlKTtcbiAgICBwYXRoID0gcGF0aC5yZXBsYWNlKGB7JHtwcmVmaXh9JHt0aGlzLm5hbWV9JHt0aGlzLm9wdGlvbnMuZXhwbG9kZSA/ICcqJyA6ICcnfX1gLCB2YWx1ZSk7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cblxuICAvLyBAdHMtaWdub3JlXG4gIHNlcmlhbGl6ZVZhbHVlKHZhbHVlOiBhbnksIHNlcGFyYXRvciA9ICcsJyk6IHN0cmluZyB7XG4gICAgdmFyIHJlc3VsdCA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpIDogc3VwZXIuc2VyaWFsaXplVmFsdWUodmFsdWUsIHNlcGFyYXRvcik7XG4gICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoLyUzRC9nLCAnPScpO1xuICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC8lM0IvZywgJzsnKTtcbiAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvJTJDL2csICcsJyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vKipcbiAqIEEgcGFyYW1ldGVyIGluIHRoZSBxdWVyeVxuICovXG5jbGFzcyBRdWVyeVBhcmFtZXRlciBleHRlbmRzIFBhcmFtZXRlciB7XG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgb3B0aW9uczogUGFyYW1ldGVyT3B0aW9ucykge1xuICAgIHN1cGVyKG5hbWUsIHZhbHVlLCBvcHRpb25zLCAnZm9ybScsIHRydWUpO1xuICB9XG5cbiAgYXBwZW5kKHBhcmFtczogSHR0cFBhcmFtcyk6IEh0dHBQYXJhbXMge1xuICAgIGlmICh0aGlzLnZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIC8vIEFycmF5IHNlcmlhbGl6YXRpb25cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXhwbG9kZSkge1xuICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdGhpcy52YWx1ZSkge1xuICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQodGhpcy5uYW1lLCB0aGlzLnNlcmlhbGl6ZVZhbHVlKHYpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gdGhpcy5vcHRpb25zLnN0eWxlID09PSAnc3BhY2VEZWxpbWl0ZWQnXG4gICAgICAgICAgPyAnICcgOiB0aGlzLm9wdGlvbnMuc3R5bGUgPT09ICdwaXBlRGVsaW1pdGVkJ1xuICAgICAgICAgICAgPyAnfCcgOiAnLCc7XG4gICAgICAgIHJldHVybiBwYXJhbXMuYXBwZW5kKHRoaXMubmFtZSwgdGhpcy5zZXJpYWxpemVWYWx1ZSh0aGlzLnZhbHVlLCBzZXBhcmF0b3IpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMudmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHRoaXMudmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAvLyBPYmplY3Qgc2VyaWFsaXphdGlvblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdHlsZSA9PT0gJ2RlZXBPYmplY3QnKSB7XG4gICAgICAgIC8vIEFwcGVuZCBhIHBhcmFtZXRlciBmb3IgZWFjaCBrZXksIGluIHRoZSBmb3JtIGBuYW1lW2tleV1gXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgY29uc3QgcHJvcFZhbCA9IHRoaXMudmFsdWVba2V5XTtcbiAgICAgICAgICBpZiAocHJvcFZhbCAhPT0gbnVsbCAmJiBwcm9wVmFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoYCR7dGhpcy5uYW1lfVske2tleX1dYCwgdGhpcy5zZXJpYWxpemVWYWx1ZShwcm9wVmFsKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5leHBsb2RlKSB7XG4gICAgICAgIC8vIEFwcGVuZCBhIHBhcmFtZXRlciBmb3IgZWFjaCBrZXkgd2l0aG91dCB1c2luZyB0aGUgcGFyYW1ldGVyIG5hbWVcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy52YWx1ZSkpIHtcbiAgICAgICAgICBjb25zdCBwcm9wVmFsID0gdGhpcy52YWx1ZVtrZXldO1xuICAgICAgICAgIGlmIChwcm9wVmFsICE9PSBudWxsICYmIHByb3BWYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZChrZXksIHRoaXMuc2VyaWFsaXplVmFsdWUocHJvcFZhbCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQXBwZW5kIGEgc2luZ2xlIHBhcmFtZXRlciB3aG9zZSB2YWx1ZXMgYXJlIGEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2Yga2V5LHZhbHVlLGtleSx2YWx1ZS4uLlxuICAgICAgICBjb25zdCBhcnJheTogYW55W10gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy52YWx1ZSkpIHtcbiAgICAgICAgICBjb25zdCBwcm9wVmFsID0gdGhpcy52YWx1ZVtrZXldO1xuICAgICAgICAgIGlmIChwcm9wVmFsICE9PSBudWxsICYmIHByb3BWYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgYXJyYXkucHVzaChrZXkpO1xuICAgICAgICAgICAgYXJyYXkucHVzaChwcm9wVmFsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCh0aGlzLm5hbWUsIHRoaXMuc2VyaWFsaXplVmFsdWUoYXJyYXkpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMudmFsdWUgIT09IG51bGwgJiYgdGhpcy52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBQbGFpbiB2YWx1ZVxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCh0aGlzLm5hbWUsIHRoaXMuc2VyaWFsaXplVmFsdWUodGhpcy52YWx1ZSkpO1xuICAgIH1cbiAgICByZXR1cm4gcGFyYW1zO1xuICB9XG59XG5cbi8qKlxuICogQSBwYXJhbWV0ZXIgaW4gdGhlIEhUVFAgcmVxdWVzdCBoZWFkZXJcbiAqL1xuY2xhc3MgSGVhZGVyUGFyYW1ldGVyIGV4dGVuZHMgUGFyYW1ldGVyIHtcbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCB2YWx1ZTogYW55LCBvcHRpb25zOiBQYXJhbWV0ZXJPcHRpb25zKSB7XG4gICAgc3VwZXIobmFtZSwgdmFsdWUsIG9wdGlvbnMsICdzaW1wbGUnLCBmYWxzZSk7XG4gIH1cblxuICBhcHBlbmQoaGVhZGVyczogSHR0cEhlYWRlcnMpOiBIdHRwSGVhZGVycyB7XG4gICAgaWYgKHRoaXMudmFsdWUgIT09IG51bGwgJiYgdGhpcy52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGZvciAoY29uc3QgdiBvZiB0aGlzLnZhbHVlKSB7XG4gICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuYXBwZW5kKHRoaXMubmFtZSwgdGhpcy5zZXJpYWxpemVWYWx1ZSh2KSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLmFwcGVuZCh0aGlzLm5hbWUsIHRoaXMuc2VyaWFsaXplVmFsdWUodGhpcy52YWx1ZSkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGVhZGVycztcbiAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBidWlsZCBodHRwIHJlcXVlc3RzIGZyb20gcGFyYW1ldGVyc1xuICovXG5leHBvcnQgY2xhc3MgUmVxdWVzdEJ1aWxkZXIge1xuXG4gIHByaXZhdGUgX3BhdGggPSBuZXcgTWFwPHN0cmluZywgUGF0aFBhcmFtZXRlcj4oKTtcbiAgcHJpdmF0ZSBfcXVlcnkgPSBuZXcgTWFwPHN0cmluZywgUXVlcnlQYXJhbWV0ZXI+KCk7XG4gIHByaXZhdGUgX2hlYWRlciA9IG5ldyBNYXA8c3RyaW5nLCBIZWFkZXJQYXJhbWV0ZXI+KCk7XG4gIF9ib2R5Q29udGVudDogYW55IHwgbnVsbDtcbiAgX2JvZHlDb250ZW50VHlwZT86IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcm9vdFVybDogc3RyaW5nLFxuICAgIHB1YmxpYyBvcGVyYXRpb25QYXRoOiBzdHJpbmcsXG4gICAgcHVibGljIG1ldGhvZDogc3RyaW5nKSB7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBhIHBhdGggcGFyYW1ldGVyXG4gICAqL1xuICBwYXRoKG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgb3B0aW9ucz86IFBhcmFtZXRlck9wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLl9wYXRoLnNldChuYW1lLCBuZXcgUGF0aFBhcmFtZXRlcihuYW1lLCB2YWx1ZSwgb3B0aW9ucyB8fCB7fSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYSBxdWVyeSBwYXJhbWV0ZXJcbiAgICovXG4gIHF1ZXJ5KG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgb3B0aW9ucz86IFBhcmFtZXRlck9wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLl9xdWVyeS5zZXQobmFtZSwgbmV3IFF1ZXJ5UGFyYW1ldGVyKG5hbWUsIHZhbHVlLCBvcHRpb25zIHx8IHt9KSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBhIGhlYWRlciBwYXJhbWV0ZXJcbiAgICovXG4gIGhlYWRlcihuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIG9wdGlvbnM/OiBQYXJhbWV0ZXJPcHRpb25zKTogdm9pZCB7XG4gICAgdGhpcy5faGVhZGVyLnNldChuYW1lLCBuZXcgSGVhZGVyUGFyYW1ldGVyKG5hbWUsIHZhbHVlLCBvcHRpb25zIHx8IHt9KSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgYm9keSBjb250ZW50LCBhbG9uZyB3aXRoIHRoZSBjb250ZW50IHR5cGVcbiAgICovXG4gIGJvZHkodmFsdWU6IGFueSwgY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24vanNvbicpOiB2b2lkIHtcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBCbG9iKSB7XG4gICAgICB0aGlzLl9ib2R5Q29udGVudFR5cGUgPSB2YWx1ZS50eXBlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9ib2R5Q29udGVudFR5cGUgPSBjb250ZW50VHlwZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX2JvZHlDb250ZW50VHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgJiYgdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgLy8gSGFuZGxlIFVSTC1lbmNvZGVkIGRhdGFcbiAgICAgIGNvbnN0IHBhaXJzOiBBcnJheTxbc3RyaW5nLCBzdHJpbmddPiA9IFtdO1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModmFsdWUpKSB7XG4gICAgICAgIGxldCB2YWwgPSB2YWx1ZVtrZXldO1xuICAgICAgICBpZiAoISh2YWwgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgICB2YWwgPSBbdmFsXTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdmFsKSB7XG4gICAgICAgICAgY29uc3QgZm9ybVZhbHVlID0gdGhpcy5mb3JtRGF0YVZhbHVlKHYpO1xuICAgICAgICAgIGlmIChmb3JtVmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHBhaXJzLnB1c2goW2tleSwgZm9ybVZhbHVlXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9ib2R5Q29udGVudCA9IHBhaXJzLm1hcChwID0+IGAke2VuY29kZVVSSUNvbXBvbmVudChwWzBdKX09JHtlbmNvZGVVUklDb21wb25lbnQocFsxXSl9YCkuam9pbignJicpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUNvbnRlbnRUeXBlID09PSAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpIHtcbiAgICAgIC8vIEhhbmRsZSBtdWx0aXBhcnQgZm9ybSBkYXRhXG4gICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModmFsdWUpKSB7XG4gICAgICAgICAgY29uc3QgdmFsID0gdmFsdWVba2V5XTtcbiAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiB2YWwpIHtcbiAgICAgICAgICAgICAgY29uc3QgdG9BcHBlbmQgPSB0aGlzLmZvcm1EYXRhVmFsdWUodik7XG4gICAgICAgICAgICAgIGlmICh0b0FwcGVuZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChrZXksIHRvQXBwZW5kKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0b0FwcGVuZCA9IHRoaXMuZm9ybURhdGFWYWx1ZSh2YWwpO1xuICAgICAgICAgICAgaWYgKHRvQXBwZW5kICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGZvcm1EYXRhLnNldChrZXksIHRvQXBwZW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2JvZHlDb250ZW50ID0gZm9ybURhdGE7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoZSBib2R5IGlzIHRoZSBwbGFpbiBjb250ZW50XG4gICAgICB0aGlzLl9ib2R5Q29udGVudCA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZm9ybURhdGFWYWx1ZSh2YWx1ZTogYW55KTogYW55IHtcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBuZXcgQmxvYihbSlNPTi5zdHJpbmdpZnkodmFsdWUpXSwge3R5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ30pXG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcodmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyB0aGUgcmVxdWVzdCB3aXRoIHRoZSBjdXJyZW50IHNldCBwYXJhbWV0ZXJzXG4gICAqL1xuICBidWlsZDxUID0gYW55PihvcHRpb25zPzoge1xuICAgIC8qKiBXaGljaCBjb250ZW50IHR5cGVzIHRvIGFjY2VwdCAqL1xuICAgIGFjY2VwdD86IHN0cmluZztcblxuICAgIC8qKiBUaGUgZXhwZWN0ZWQgcmVzcG9uc2UgdHlwZSAqL1xuICAgIHJlc3BvbnNlVHlwZT86ICdqc29uJyB8ICd0ZXh0JyB8ICdibG9iJyB8ICdhcnJheWJ1ZmZlcic7XG5cbiAgICAvKiogV2hldGhlciB0byByZXBvcnQgcHJvZ3Jlc3Mgb24gdXBsb2FkcyAvIGRvd25sb2FkcyAqL1xuICAgIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbjtcblxuICAgIC8qKiBBbGxvdyBwYXNzaW5nIEh0dHBDb250ZXh0IGZvciBIdHRwQ2xpZW50ICovXG4gICAgY29udGV4dD86IEh0dHBDb250ZXh0O1xuICB9KTogSHR0cFJlcXVlc3Q8VD4ge1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAvLyBQYXRoIHBhcmFtZXRlcnNcbiAgICBsZXQgcGF0aCA9IHRoaXMub3BlcmF0aW9uUGF0aDtcbiAgICBmb3IgKGNvbnN0IHBhdGhQYXJhbSBvZiB0aGlzLl9wYXRoLnZhbHVlcygpKSB7XG4gICAgICBwYXRoID0gcGF0aFBhcmFtLmFwcGVuZChwYXRoKTtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gdGhpcy5yb290VXJsICsgcGF0aDtcblxuICAgIC8vIFF1ZXJ5IHBhcmFtZXRlcnNcbiAgICBsZXQgaHR0cFBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKHtcbiAgICAgIGVuY29kZXI6IFBhcmFtZXRlckNvZGVjSW5zdGFuY2VcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IHF1ZXJ5UGFyYW0gb2YgdGhpcy5fcXVlcnkudmFsdWVzKCkpIHtcbiAgICAgIGh0dHBQYXJhbXMgPSBxdWVyeVBhcmFtLmFwcGVuZChodHRwUGFyYW1zKTtcbiAgICB9XG5cbiAgICAvLyBIZWFkZXIgcGFyYW1ldGVyc1xuICAgIGxldCBodHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgIGlmIChvcHRpb25zLmFjY2VwdCkge1xuICAgICAgaHR0cEhlYWRlcnMgPSBodHRwSGVhZGVycy5hcHBlbmQoJ0FjY2VwdCcsIG9wdGlvbnMuYWNjZXB0KTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBoZWFkZXJQYXJhbSBvZiB0aGlzLl9oZWFkZXIudmFsdWVzKCkpIHtcbiAgICAgIGh0dHBIZWFkZXJzID0gaGVhZGVyUGFyYW0uYXBwZW5kKGh0dHBIZWFkZXJzKTtcbiAgICB9XG5cbiAgICAvLyBSZXF1ZXN0IGNvbnRlbnQgaGVhZGVyc1xuICAgIGlmICh0aGlzLl9ib2R5Q29udGVudFR5cGUgJiYgISh0aGlzLl9ib2R5Q29udGVudCBpbnN0YW5jZW9mIEZvcm1EYXRhKSkge1xuICAgICAgaHR0cEhlYWRlcnMgPSBodHRwSGVhZGVycy5zZXQoJ0NvbnRlbnQtVHlwZScsIHRoaXMuX2JvZHlDb250ZW50VHlwZSk7XG4gICAgfVxuXG4gICAgLy8gUGVyZm9ybSB0aGUgcmVxdWVzdFxuICAgIHJldHVybiBuZXcgSHR0cFJlcXVlc3Q8VD4odGhpcy5tZXRob2QudG9VcHBlckNhc2UoKSwgdXJsLCB0aGlzLl9ib2R5Q29udGVudCwge1xuICAgICAgcGFyYW1zOiBodHRwUGFyYW1zLFxuICAgICAgaGVhZGVyczogaHR0cEhlYWRlcnMsXG4gICAgICByZXNwb25zZVR5cGU6IG9wdGlvbnMucmVzcG9uc2VUeXBlLFxuICAgICAgcmVwb3J0UHJvZ3Jlc3M6IG9wdGlvbnMucmVwb3J0UHJvZ3Jlc3MsXG4gICAgICBjb250ZXh0OiBvcHRpb25zLmNvbnRleHRcbiAgICB9KTtcbiAgfVxufVxuIl19